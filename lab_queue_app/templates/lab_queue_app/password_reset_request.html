{% extends 'lab_queue_app/base.html' %}
{% block title %}Сброс пароля{% endblock %}
{% block content %}
    <h2>Сброс пароля</h2>
    {% if error %}<p style="color: red;">{{ error }}</p>{% endif %}
    {% if message %}
        <p style="color: green;">{{ message }}</p>
    {% endif %}

    <form method="post" id="resetForm">
        {% csrf_token %}
        <label for="{{ form.email.id_for_label }}">Электронная почта:</label><br>
        {{ form.email }}
        {{ form.email.errors }}
        <br>
        <button type="submit" id="resetBtn" {% if seconds_left > 0 %}disabled{% endif %}>
            {% if seconds_left > 0 %}Отправить повторно{% else %}Отправить ссылку{% endif %}
        </button>
        {% if show_captcha %}
            <div style="margin-top: 10px;">{{ captcha_form.captcha }}</div>
            <script src="https://www.google.com/recaptcha/api.js" async defer></script>
        {% endif %}
    </form>

    <div id="timer" style="margin-top: 10px;"></div>

    <script>
        let secondsLeft = Number({{ seconds_left|default:0 }});
        const resendTimeout = Number({{ resend_timeout|default:60 }});
        const resetBtn = document.getElementById('resetBtn');
        const timerDiv = document.getElementById('timer');

        function updateTimer() {
            if (secondsLeft > 0) {
                resetBtn.disabled = true;
                resetBtn.textContent = "Отправить повторно";
                timerDiv.textContent = "Повторная отправка доступна через " + secondsLeft + " сек.";
                secondsLeft--;
                setTimeout(updateTimer, 1000);
            } else {
                resetBtn.disabled = false;
                resetBtn.textContent = "Отправить ссылку";
                timerDiv.textContent = "";
            }
        }

        updateTimer();
    </script>
{% endblock %}